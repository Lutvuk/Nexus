<div class="w-80 flex-shrink-0 flex flex-col max-h-full h-full">
    <!-- Column Header -->
    <div class="flex items-center justify-between mb-4 p-2 cursor-move cdk-drag-handle">
        <h2 class="font-bold text-white/90 text-sm uppercase tracking-wider flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-violet-500/50 border border-violet-400"></span>
            {{ column.name }}
            <span class="ml-2 text-xs text-white/40 bg-white/5 py-0.5 px-2 rounded-full">{{ column.cards.length
                }}</span>
        </h2>
        <button (click)="deleteColumn()"
            class="text-white/40 hover:text-red-400 transition-colors p-1 rounded hover:bg-white/5">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
        </button>
    </div>

    <!-- Drop List Container -->
    <!-- data = column.cards (the array to mutate) -->
    <div cdkDropList [id]="column.id" [cdkDropListData]="column.cards"
        class="flex-1 bg-white/5 rounded-xl border border-white/5 p-3 flex flex-col gap-3 overflow-y-auto custom-scrollbar min-h-[100px]"
        (cdkDropListDropped)="drop($event)">

        @for (card of column.cards; track card.id) {
        <app-nexus-card [card]="card" cdkDrag [cdkDragData]="card" class="block">

            <!-- Custom Drag Placeholder -->
            <div *cdkDragPlaceholder class="opacity-0"></div>

            <!-- Custom Drag Preview (NO transitions, NO blur for performance) -->
            <div *cdkDragPreview
                class="p-4 bg-violet-900 border border-violet-500/50 shadow-2xl shadow-violet-500/30 rotate-3 cursor-grabbing rounded-xl">
                <h3 class="font-medium text-white">{{ card.title }}</h3>
            </div>

        </app-nexus-card>
        }

        <!-- Add Task Button -->
        <button (click)="openAddTask()"
            class="w-full py-2 rounded-lg border border-dashed border-white/10 text-white/40 text-sm hover:text-violet-300 hover:border-violet-500/30 hover:bg-violet-500/5 transition-all flex items-center justify-center gap-2 mt-auto">
            <span>+</span> Add Task
        </button>
    </div>
</div>